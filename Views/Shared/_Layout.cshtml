<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - IMS</title>
    
    <!-- Favicon -->
     
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/IMS.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa; /* Light gray background */
            height: 100vh; /* Full height */
            margin: 0;
            display: flex;
        }

        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            transition: width 0.3s;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            white-space: wrap;
        }



            .sidebar.collapsed {
                width: 70px;
            }

            .sidebar .toggle-btn {
                background-color: darkslategrey;
                color: white;
                /* padding: 10px; */
                cursor: pointer;
                text-align: center;
            }

            .sidebar a {
                color: #ecf0f1;
                padding: 15px 20px;
                display: flex;
                align-items: center;
                text-decoration: none;
                white-space: nowrap;
                line-height: 1.4;
                transition: all 0.3s ease;
                border-left: 3px solid transparent;
            }

                .sidebar a:hover {
                background-color: #34495e;
                color: #3498db;
                border-left-color: #3498db;
            }

            .sidebar a i {
                width: 20px;
                margin-right: 10px;
                text-align: center;
            }

            .sidebar a .fa-angle-down {
                margin-left: auto;
                transition: transform 0.3s ease;
            }

            .sidebar a.expanded .fa-angle-down {
                transform: rotate(180deg);
            }

        .menu-item {
            position: relative;
                }

        .submenu {
            display: none;
            background-color: #34495e;
            padding-left: 0;
            margin-left: 0;
            border-left: 3px solid #3498db;
        }

        .submenu a {
            padding: 12px 20px 12px 50px;
            font-size: 0.9em;
            border-left: none;
        }

        .submenu a:hover {
            background-color: #2c3e50;
            color: #3498db;
        }

        .menu-item.has-submenu > a {
            cursor: pointer;
        }

        .nav-link:hover {
            background-color: gray;
        }

        .main {
            flex-grow: 1;
            padding: 8px;
            transition: margin-left 0.3s;
            min-width: 0;
            overflow-x: auto;
        }

        .sidebar.collapsed a span {
            display: none;
        }

        .sidebar.collapsed .submenu {
            display: none !important;
        }

        .sidebar.collapsed a {
            justify-content: center;
            padding: 15px 10px;
        }

        .sidebar.collapsed a i {
            margin-right: 0;
        }

        .sidebar.collapsed .fa-angle-down {
            display: none;
        }

        /* Tooltip for collapsed state */
        .sidebar.collapsed .menu-item {
            position: relative;
        }

        .sidebar.collapsed .menu-item:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 70px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            font-size: 0.9em;
        }
        /* Custom styles for the table */
        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }

        .custom-table thead {
            background: linear-gradient(45deg, #007bff, #6610f2);
            color: white;
            text-transform: uppercase;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .custom-table th, .custom-table td {
            vertical-align: middle;
            padding: 12px;
        }

        .custom-table tbody tr {
            transition: background-color 0.3s ease;
        }

            .custom-table tbody tr:hover {
                background-color: limegreen;
            }

        .custom-table .btn {
            margin: 0 5px;
        }

        .custom-table .table-actions {
            white-space: nowrap;
        }

        /* Scrollable table container */
        .table-responsive {
            max-height: 70vh;
            overflow-y: auto;
            overflow-x: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }

        /* Custom scrollbar for better appearance */
        .table-responsive::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Ensure table cells don't break layout */
        .custom-table th,
        .custom-table td {
            white-space: nowrap;
            min-width: 120px;
        }

        /* Allow text wrapping for specific columns if needed */
        .custom-table .text-wrap {
            white-space: normal;
            word-wrap: break-word;
            max-width: 200px;
        }
    </style>
    @RenderSection("Styles", required: false)
</head>
<body>
    @{
        bool isAdmin = Convert.ToBoolean(User.FindFirst("IsAdmin")?.Value);
        string role = isAdmin ? "Admin" : "User";
    }
    @if (!string.IsNullOrEmpty(role))
    {

     
        <div class="sidebar" id="sidebar">
            <div class="toggle-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>

            @* Dashboard *@
            @if (role == "Admin")
            {
                <div class="menu-item">

                    <a asp-controller="Home" asp-action="Index"><i class="fa-solid fa-house"></i> <span>    Dashboard</span></a>
                </div>


            }

            @* Admin *@
            @if (role == "Admin")
            {
                <div class="menu-item has-submenu" data-tooltip="Admin">
                    <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-user-tie"></i><span>Admin <i class="fa-solid fa-angle-down"></i></span></a>
                    <div class="submenu">
                        <a asp-controller="User" asp-action="GetAllUsers"><i class="fa-solid fa-people-group"></i><span>Users</span></a>
                    </div>
                </div>
            }





            <div class="menu-item has-submenu" data-tooltip="Customer">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-user"></i><span>Customer <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Customer" asp-action="Index"><i class="fa-solid fa-users"></i><span>Customers</span></a>
                    <a asp-controller="Sales" asp-action="Index"><i class="fa-solid fa-address-book"></i><span>Sales</span></a>
                    <a asp-controller="Sales" asp-action="AddSale"><i class="fa-solid fa-plus"></i><span>Add Sale</span></a>
                    <a asp-controller="CustomerPayment" asp-action="Index"><i class="fa-solid fa-sack-dollar"></i><span>Payments</span></a>
                </div>
            </div>
            <div class="menu-item has-submenu" data-tooltip="Vendor">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-person-walking-arrow-right"></i><span>Vendor <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Vendor" asp-action="Index"><i class="fa-solid fa-person-walking-arrow-right"></i><span>Vendors</span></a>
                    <a asp-controller="VendorBills" asp-action="Index"><i class="fa-solid fa-file-invoice-dollar"></i><span>Bills</span></a>
                    <a asp-controller="VendorBills" asp-action="Create"><i class="fa-solid fa-print"></i><span>Generate Bills</span></a>
                    <a asp-controller="VendorPayments" asp-action="Index"><i class="fa-solid fa-sack-dollar"></i><span>Payments</span></a>
                </div>
            </div>
            <div class="menu-item has-submenu" data-tooltip="Employee">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-user-tie"></i><span>Employee <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Employee" asp-action="Index"><i class="fa-solid fa-people-group"></i><span>Employees</span></a>
                </div>
            </div>

            <div class="menu-item has-submenu" data-tooltip="Product">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-gift"></i><span>Product <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Product" asp-action="Index"><i class="fa-solid fa-gift"></i><span>Products</span></a>
                </div>
            </div>
            
            <div class="menu-item has-submenu" data-tooltip="Stock">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-layer-group"></i><span>Stock <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Stock" asp-action="Index"><i class="fa-solid fa-layer-group"></i><span>Stocks</span></a>
                </div>
            </div>
            <div class="menu-item has-submenu" data-tooltip="Expense">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-sack-dollar"></i><span>Expense <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Expense" asp-action="Index"><i class="fa-solid fa-sack-dollar"></i><span>Expenses</span></a>
                    <a asp-controller="PersonalPayments" asp-action="Index"><i class="fa-solid fa-credit-card"></i><span>Personal Payments</span></a>
                </div>
            </div>

            <div class="menu-item has-submenu" data-tooltip="Reports">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-address-book"></i><span>Reports <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Report" asp-action="SalesReport"><i class="fa-solid fa-address-book"></i><span>Sales Report</span></a>
                </div>
            </div>


            <div class="menu-item has-submenu" data-tooltip="Settings">
                <a href="#" onclick="toggleSubmenu(this); return false;"><i class="fa-solid fa-gear"></i><span>Settings <i class="fa-solid fa-angle-down"></i></span></a>
                <div class="submenu">
                    <a asp-controller="Settings" asp-action="GetAllExpenseTypes"><i class="fa-solid fa-sack-dollar"></i><span>Expense Types</span></a>
                    <a asp-controller="SettingsAdminLabels" asp-action="Index"><i class="fa-solid fa-building"></i><span>Company Labels</span></a>
                    <a asp-controller="Categories" asp-action="Index"><i class="fa-solid fa-list"></i><span>Admin Categories</span></a>
                    <a asp-controller="AdminMeasuringUnitTypes" asp-action="Index"><i class="fa-solid fa-text-height"></i><span>Measuring Unit Types</span></a>
                    <a asp-controller="MeasuringUnit" asp-action="Index"><i class="fa-solid fa-helmet-un"></i><span>Measuring Units</span></a>
                </div>
            </div>
         

        </div>

        <div class="main" id="main">
            <div aria-live="polite" aria-atomic="true" class="position-relative">
                <div class="toast-container position-absolute top-0 end-0 p-3">
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="toast align-items-center text-white bg-danger border-0 show"
                             role="alert" aria-live="assertive" aria-atomic="true"
                             data-bs-delay="4000" data-bs-autohide="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="fa-solid fa-circle-exclamation"></i> @TempData["ErrorMessage"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }
                    @if (TempData["Success"] != null)
                    {
                        <div class="toast align-items-xl-stretch text-white bg-success border-0 show"
                             role="alert" aria-live="assertive" aria-atomic="true"
                             data-bs-delay="4000" data-bs-autohide="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="fa-solid fa-circle-exclamation"></i> @TempData["Success"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                        data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }
                    @if (TempData["InfoMessage"] != null)
                    {
                        <div class="toast align-items-xl-stretch text-white bg-info border-0 show"
                             role="alert" aria-live="assertive" aria-atomic="true"
                             data-bs-delay="4000" data-bs-autohide="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="fa-solid fa-circle-exclamation"></i> @TempData["InfoMessage"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }
                    @if (TempData["WarningMessage"] != null)
                    {
                        <div class="toast align-items-xl-stretch text-white bg-warning border-0 show"
                             role="alert" aria-live="assertive" aria-atomic="true"
                             data-bs-delay="4000" data-bs-autohide="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="fa-solid fa-circle-exclamation"></i> @TempData["WarningMessage"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }

                </div>
            </div>
        
            <div style="width: inherit; height: fit-content; background-color: gold; display: flex; align-items: center; justify-content: space-between; padding: 10px 20px;">
                <!-- Empty left side for balance -->
                <div style="flex: 1;"></div>

                <!-- Center: Project Name -->
                <h1 style="text-decoration:solid; color: gray; margin: 0; flex: 1; text-align: center;">
                    IMTraders
                </h1>

                <!-- Right: Username, Role, and Logout (Profile-like) -->
                <div style="flex: 1; text-align: right; display: flex; align-items: center; justify-content: flex-end; gap: 10px;">
                    @if (Context.User.Identity.IsAuthenticated)
                    {
                        <span style="font-weight: bold; color: navy;">
                            @Context.User.Identity.Name
                        </span>
                        <span style="color: gray; font-style: italic;">

                            (@role)


                        </span>                 
                        <a asp-controller="Account" asp-action="Logout" class="btn btn-outline-danger btn-sm"><i class="fa-solid fa-circle-user"></i> <span>Logout</span></a>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-outline-primary btn-sm">
                            Login
                        </a>
                    }
                </div>
            </div>          
            @RenderBody()
           
        </div>
        <script>
            function toggleSidebar() {
                $('#sidebar').toggleClass('collapsed');
            }

            function toggleSubmenu(element) {
                const menuItem = element.closest('.menu-item');
                const submenu = menuItem.querySelector('.submenu');
                const arrow = element.querySelector('.fa-angle-down');
                
                // Close all other submenus
                document.querySelectorAll('.menu-item.has-submenu').forEach(item => {
                    if (item !== menuItem) {
                        const otherSubmenu = item.querySelector('.submenu');
                        const otherArrow = item.querySelector('.fa-angle-down');
                        if (otherSubmenu) {
                            otherSubmenu.style.display = 'none';
                        }
                        if (otherArrow) {
                            otherArrow.classList.remove('expanded');
                        }
                    }
                });
                
                // Toggle current submenu
                if (submenu) {
                    if (submenu.style.display === 'none' || submenu.style.display === '') {
                        submenu.style.display = 'block';
                        if (arrow) {
                            arrow.classList.add('expanded');
                        }
                    } else {
                        submenu.style.display = 'none';
                        if (arrow) {
                            arrow.classList.remove('expanded');
                        }
                    }
                }
            }

                    document.addEventListener("DOMContentLoaded", function () {
                    var toastElList = [].slice.call(document.querySelectorAll('.toast'))
                    toastElList.map(function (toastEl) {
                        var toast = new bootstrap.Toast(toastEl)
                        toast.show(); // show toast on page load
                    })
                });

        </script>

        <!-- Kendo UI CSS -->
        <link href="~/KendoDropdown/kendoUI/kendo.bootstrap.min.css" rel="stylesheet" />
        <link href="~/KendoDropdown/kendoUI/kendo.common-bootstrap.min.css" rel="stylesheet" />
        <link href="~/KendoDropdown/defaultKendoStyleOverride.css" rel="stylesheet" />
       
  
        <!-- jQuery and Bootstrap -->
        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="~/js/site.js" asp-append-version="true"></script>
        
        <!-- Kendo UI Scripts - Load in correct dependency order -->
        <script src="~/KendoDropdown/kendoScripts/kendo.core.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.data.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.popup.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.list.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.selectable.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.dropdownlist.min.js"></script>
        <script src="~/KendoDropdown/kendoScripts/kendo.combobox.min.js"></script>
        
        <!-- Essential Services Only -->
        <script src="~/js/error-handler.js"></script>
        <script src="~/js/loading-service.js"></script>
        <script src="~/js/notification-service.js"></script>
        
        @await RenderSectionAsync("Scripts", required: false)
    }
</body>
</html>

