@model IMS.DAL.PrimaryDBContext.Sale
@{
    ViewData["Title"] = "Add Sale";
}

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <form asp-action="Create" method="post">
                <div class="card-header" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none;">
                    <h2 class="mb-0">Add New Sale</h2>
                </div>
                <div class="card-body">
                    <div class="row row-cols-1 row-cols-md-2 g-4 mt-2">
                        <div class="col">
                            <label class="form-label">Bill Number:</label>
                            <input type="number" class="form-control" value="@ViewBag.NextBillNumber" readonly />
                            <input type="hidden" asp-for="BillNumber" value="@ViewBag.NextBillNumber" />
                        </div>
                        <div class="col">
                            <label asp-for="SaleDate" class="form-label">Sale Date:</label>
                            <input asp-for="SaleDate" class="form-control" type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            <span asp-validation-for="SaleDate" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label class="form-label">Customer:</label>
                            @Html.DropDownList("CustomerIdFk", ViewBag.Customers as IEnumerable<SelectListItem>, "<-- Select Customer -->", new { @class = "form-control" })
                            <span asp-validation-for="CustomerIdFk" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label asp-for="TotalAmount" class="form-label">Total Amount:</label>
                            <input asp-for="TotalAmount" class="form-control" type="number" step="0.01" min="0" />
                            <span asp-validation-for="TotalAmount" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label asp-for="DiscountAmount" class="form-label">Discount Amount:</label>
                            <input asp-for="DiscountAmount" class="form-control" type="number" step="0.01" min="0" value="0" />
                            <span asp-validation-for="DiscountAmount" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label asp-for="TotalReceivedAmount" class="form-label">Received Amount:</label>
                            <input asp-for="TotalReceivedAmount" class="form-control" type="number" step="0.01" min="0" />
                            <span asp-validation-for="TotalReceivedAmount" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label asp-for="TotalDueAmount" class="form-label">Due Amount:</label>
                            <input asp-for="TotalDueAmount" class="form-control" type="number" step="0.01" min="0" readonly />
                            <span asp-validation-for="TotalDueAmount" class="text-danger"></span>
                        </div>
                        <div class="col-12">
                            <label asp-for="SaleDescription" class="form-label">Description:</label>
                            <textarea asp-for="SaleDescription" class="form-control" rows="3" placeholder="Enter sale description..."></textarea>
                            <span asp-validation-for="SaleDescription" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="mb-3 mt-4">
                        <button type="submit" class="btn btn-success">
                            <i class="fa-solid fa-save"></i> Create Sale
                        </button>
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="fa-solid fa-arrow-left"></i> Back to List
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Auto-calculate due amount when total amount, discount, or received amount changes
        document.getElementById('TotalAmount').addEventListener('input', calculateDueAmount);
        document.getElementById('DiscountAmount').addEventListener('input', calculateDueAmount);
        document.getElementById('TotalReceivedAmount').addEventListener('input', calculateDueAmount);

        function calculateDueAmount() {
            const totalAmount = parseFloat(document.getElementById('TotalAmount').value) || 0;
            const discountAmount = parseFloat(document.getElementById('DiscountAmount').value) || 0;
            const receivedAmount = parseFloat(document.getElementById('TotalReceivedAmount').value) || 0;
            const dueAmount = totalAmount - discountAmount - receivedAmount;
            document.getElementById('TotalDueAmount').value = Math.max(0, dueAmount).toFixed(2);
        }
    </script>
}


