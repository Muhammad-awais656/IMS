@model VendorBillGenerationViewModel

@{
    ViewData["Title"] = "Generate Vendor Bill";
}

<link href="~/css/dist/addsales.css" rel="stylesheet" />
@* <div class="container-fluid"> *@
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0 text-center">
                <i class="fa-solid fa-file-invoice me-2"></i>
                @if (ViewBag.IsEdit == true)
                {
                    <text>Edit Vendor Bill</text>
                }
                else
                {
                    <text>Generate Vendor Bill</text>
                }
            </h2>
        </div>

        <div class="card-body">
            <form asp-action="@(ViewBag.IsEdit == true ? "Edit" : "GenerateBill")" asp-controller="VendorBills" method="post" id="generateBillForm">
                @Html.AntiForgeryToken()
                <!-- Hidden field to track which button was clicked -->
                <input type="hidden" id="actionType" name="actionType" value="" />
                <!-- Hidden field for BillId when editing -->
                <input type="hidden" asp-for="BillId" id="billId" />

                <!-- Vendor Selection Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="text-primary mb-3">
                            <i class="fa-solid fa-truck me-2"></i>Vendor Information
                        </h5>
                    </div>
                    <div class="col-md-4">
                        <label for="vendorSelect" class="form-label">Vendor:</label>
                        <input id="vendorSelect" name="VendorId" asp-for="VendorId" style="width: 100%;" />
                    </div>
                    <div class="col-md-2">
                        <label for="billNumber" class="form-label">Bill Number:</label>
                        <input type="number" id="billNumber" asp-for="BillNumber" class="form-control" readonly />
                    </div>
                    <div class="col-md-3">
                        <label for="billDate" class="form-label">Bill Date:</label>
                        <input type="date" id="billDate" asp-for="BillDate" class="form-control" />
                    </div>
                    <div class="col-md-3">
                        <label for="description" class="form-label">Description:</label>
                        <input type="text" id="description" asp-for="Description" class="form-control" placeholder="Bill description" />
                    </div>
                </div>

                <!-- Product Selection Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="text-primary mb-3">
                            <i class="fa-solid fa-box me-2"></i>Product Selection
                        </h5>
                    </div>
                    <div class="col-md-3">
                        <label for="productSelect" class="form-label">Product:</label>
                        <input id="productSelect" name="ProductId" style="width: 100%;" />
                    </div>
                    <div class="col-md-3">
                        <label for="productSizeSelect" class="form-label">Product Size:</label>
                        <input id="productSizeSelect" name="ProductSizeId" style="width: 100%;" />
                    </div>
                    <div class="col-md-2">
                        <label for="quantity" class="form-label">Quantity:</label>
                        <input type="number" id="quantity" class="form-control" value="1" min="1" />
                    </div>
                    <div class="col-md-2">
                        <label for="unitPrice" class="form-label">Unit Price:</label>
                        <input type="number" id="unitPrice" class="form-control" value="0" step="0.01" readonly />
                    </div>
                    <div class="col-md-2">
                        <label for="purchasePrice" class="form-label">Purchase Price:</label>
                        <input type="number" id="purchasePrice" class="form-control" value="0" step="0.01" />
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="discountAmount" class="form-label">Line Discount:</label>
                        <input type="number" id="discountAmount" class="form-control" value="0" step="0.01" />
                    </div>
                    <div class="col-md-3">
                        <label for="payableAmount" class="form-label">Payable Amount:</label>
                        <input type="number" id="payableAmount" class="form-control" value="0" step="0.01" readonly />
                    </div>
                    <div class="col-md-6 d-flex align-items-end">
                        <button type="button" class="btn btn-primary me-2" id="addToTable" title="Add product to bill (Ctrl+Enter)">
                            <i class="fa-solid fa-plus me-1"></i>Add to Bill
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="resetFields" title="Reset product fields (Escape)">
                            <i class="fa-solid fa-rotate-left me-1"></i>Reset Product
                        </button>
                    </div>
                </div>

                <!-- Bill Items Table -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="text-primary mb-3">
                            <i class="fa-solid fa-list me-2"></i>Bill Items
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="billDetailsTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Code</th>
                                        <th>Product</th>
                                        <th>Item Level Discount</th>
                                        <th>Unit Price</th>
                                        <th>Purchase Price</th>
                                        <th>Qty</th>
                                        <th>Total Discount</th>
                                        <th>Payable</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="billDetailsBody">
                                    <!-- Bill items will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Payment Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h5 class="text-primary mb-3">
                            <i class="fa-solid fa-credit-card me-2"></i>Payment Information
                        </h5>
                    </div>
                    <div class="col-md-3">
                        <label for="totalAmount" class="form-label">Total Amount:</label>
                        <input type="number" id="totalAmount" asp-for="TotalAmount" class="form-control" readonly />
                    </div>
                    <div class="col-md-3">
                        <label for="discountAmountTotal" class="form-label">Total Discount:</label>
                        <input type="number" id="discountAmountTotal" asp-for="DiscountAmount" class="form-control" step="0.01" />
                    </div>
                    <div class="col-md-3">
                        <label for="payNow" class="form-label">Pay Now:</label>
                        <input type="number" id="payNow" asp-for="PayNow" class="form-control" step="0.01" />
                    </div>
                    <div class="col-md-3">
                        <label for="dueAmount" class="form-label">Due Amount:</label>
                        <input type="number" id="dueAmount" asp-for="DueAmount" class="form-control" readonly />
                    </div>
                </div>

                <!-- Payment Method Section -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label for="paymentMethod" class="form-label">Payment Method:</label>
                        <select id="paymentMethod" asp-for="PaymentMethod" class="form-select">
                            <option value="Cash">Cash</option>
                            <option value="Online">Online</option>
                            <option value="PayLater">Pay Later</option>
                        </select>
                    </div>
                    <div class="col-md-3" id="onlineAccountSection" style="display: none;">
                        <label for="onlineAccountSelect" class="form-label">Online Account:</label>
                        <input id="onlineAccountSelect" name="OnlineAccountId" style="width: 100%;" />
                    </div>
                    <div class="col-md-3" id="accountBalanceSection" style="display: none;">
                        <label for="accountBalance" class="form-label">Account Balance:</label>
                        <input type="number" id="accountBalance" class="form-control" readonly />
                    </div>
                    <div class="col-md-3" id="billAmountSection" style="display: none;">
                        <label for="billAmount" class="form-label">Bill Amount:</label>
                        <input type="number" id="billAmount" class="form-control" readonly />
                    </div>
                    <div class="col-md-3">
                        <label for="previousDue" class="form-label">Previous Due:</label>
                        <input type="number" id="previousDue" asp-for="PreviousDue" class="form-control" readonly />
                    </div>
                    <div class="col-md-3">
                        <label for="receivedAmount" class="form-label">Paid Amount:</label>
                        <input type="number" id="receivedAmount" asp-for="PaidAmount" class="form-control" readonly />
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="row">
                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-success me-2" id="saveButton">
                            <i class="fa-solid fa-save me-1"></i>
                            @if (ViewBag.IsEdit == true)
                            {
                                <text>Update Bill</text>
                            }
                            else
                            {
                                <text>Save Bill</text>
                            }
                        </button>
                        <button type="submit" class="btn btn-primary me-2" id="saveAndPrintButton">
                            <i class="fa-solid fa-print me-1"></i>
                            @if (ViewBag.IsEdit == true)
                            {
                                <text>Update & Print</text>
                            }
                            else
                            {
                                <text>Save & Print</text>
                            }
                        </button>
                        <a href="@Url.Action("Index")" class="btn btn-secondary">
                            <i class="fa-solid fa-arrow-left me-1"></i>Back to List
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
@* </div> *@

@section Scripts {
    <script src="~/js/vendor-bill-generation.js"></script>
    <script>
        // Pass edit mode and bill details data to JavaScript
        var isEditMode = '@(ViewBag.IsEdit == true ? "true" : "false")';
        var billDetailsData = @Html.Raw(Json.Serialize(Model.BillDetails ?? new List<VendorBillDetailViewModel>()))
        
        $(document).ready(function() {
            // Initialize Kendo UI components
            initializeVendorBillGeneration();
        });
    </script>
}
